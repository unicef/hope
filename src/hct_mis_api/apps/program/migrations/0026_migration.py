# Generated by Django 2.2.16 on 2021-02-23 11:09

from django.db import migrations


def assign_service_providers_based_on_ca_id(apps, schema_editor):
    CashPlan = apps.get_model("program", "CashPlan")
    ServiceProvider = apps.get_model("payment", "ServiceProvider")
    for cash_plan in CashPlan.objects.all():
        if not cash_plan.assistance_through:
            continue
        sp = ServiceProvider.objects.filter(ca_id=cash_plan.assistance_through).first()
        if not sp:
            continue
        cash_plan.service_provider = sp
        cash_plan.save()


def empty_reverse(apps, schema_editor):
    pass


class Migration(migrations.Migration):

    dependencies = [
        ("program", "0025_migration"),
    ]

    operations = [migrations.RunPython(assign_service_providers_based_on_ca_id, empty_reverse)]
