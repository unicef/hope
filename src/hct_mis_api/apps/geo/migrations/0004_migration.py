# Generated by Django 3.2.25 on 2025-03-27 08:39

from django.db import migrations, models

from hct_mis_api.apps.core.utils import chunks


def migrate_gis_point(apps, schema_editor):  # pragma: no cover
    Area = apps.get_model("geo", "Area")
    areas_id = Area.objects.filter(point__isnull=False).values_list("id", flat=True)
    for area_ids_chunk in chunks(areas_id, 100):
        areas = Area.objects.filter(id__in=area_ids_chunk)
        for area in areas:
            area.latitude = area.point.y
            area.longitude = area.point.x
        Area.objects.bulk_update(areas, ["latitude", "longitude"])


class Migration(migrations.Migration):
    dependencies = [
        ("geo", "0003_migration"),
    ]

    operations = [
        migrations.RunPython(migrate_gis_point, reverse_code=migrations.RunPython.noop),
        migrations.RemoveField(
            model_name='area',
            name='point',
        ),
    ]
