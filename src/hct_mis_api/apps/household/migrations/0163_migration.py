# Generated by Django 3.2.22 on 2023-12-05 08:57

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ("household", "0162_migration"),
    ]

    operations = [
        migrations.RunSQL("""
        CREATE OR REPLACE FUNCTION create_hh_unicef_id() RETURNS trigger
            LANGUAGE plpgsql
            AS $$
        begin
            IF NEW.unicef_id IS NULL THEN
                NEW.unicef_id := format('HH-%s-%s',TO_CHAR(NEW.first_registration_date, 'yy'), trim(replace(to_char(NEW.unicef_id_index,'0000,0000'),',','.')));
            END IF;
            return NEW;
        end
        $$;
        """, reverse_sql=migrations.RunSQL.noop,),
        migrations.RunSQL("""
        CREATE OR REPLACE FUNCTION create_ii_unicef_id() RETURNS trigger
            LANGUAGE plpgsql
            AS $$
        begin 
            IF NEW.unicef_id IS NULL THEN
                NEW.unicef_id := format('IND-%s-%s',TO_CHAR(NEW.first_registration_date, 'yy'), trim(replace(to_char(NEW.unicef_id_index,'0000,0000'),',','.')));
            END IF;
            return NEW;
        end
        $$;
        """, reverse_sql=migrations.RunSQL.noop,)
    ]
