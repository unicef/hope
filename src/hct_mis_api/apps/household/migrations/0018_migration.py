# Generated by Django 3.2.25 on 2025-03-27 08:39

from django.db import migrations

from hct_mis_api.apps.core.utils import chunks


def migrate_gis_geopoint(apps, schema_editor):  # pragma: no cover
    Household = apps.get_model("household", "Household")
    household_ids = Household.objects.filter(geopoint__isnull=False).values_list("id", flat=True)
    for household_ids_chunk in chunks(household_ids, 100):
        households = Household.objects.filter(id__in=household_ids_chunk)
        for household in households:
            household.latitude = household.geopoint.y
            household.longitude = household.geopoint.x
        Household.objects.bulk_update(households, ["latitude", "longitude"])


class Migration(migrations.Migration):
    dependencies = [
        ("household", "0017_migration"),
    ]

    operations = [
        migrations.RunPython(migrate_gis_geopoint, reverse_code=migrations.RunPython.noop),
        migrations.RemoveField(
            model_name="household",
            name="geopoint",
        ),
    ]
