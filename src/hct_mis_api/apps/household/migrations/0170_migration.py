# Generated by Django 3.2.23 on 2024-02-20 23:24

from django.db import migrations


class Migration(migrations.Migration):
    dependencies = [
        ('household', '0148_migration_squashed_0169_migration'),
    ]

    operations = [
        migrations.RunSQL(
            """
                CREATE OR REPLACE FUNCTION create_hhc_unicef_id() RETURNS trigger
                    LANGUAGE plpgsql
                    AS $$
                begin
                    IF NEW.unicef_id IS NULL THEN
                        NEW.unicef_id := format('HHC-%s', trim(replace(to_char(NEW.unicef_id_index,'0000,0000'),',','.')));
                    END IF;
                    return NEW;
                end
                $$;
                CREATE TRIGGER create_hhc_unicef_id BEFORE INSERT ON household_householdcollection 
                FOR EACH ROW EXECUTE PROCEDURE create_hhc_unicef_id();
                """,
            reverse_sql="""
              DROP TRIGGER IF EXISTS create_hhc_unicef_id
              ON household_householdcollection;
            """
        ),
        migrations.RunSQL(
            """
                CREATE OR REPLACE FUNCTION create_indc_unicef_id() RETURNS trigger
                    LANGUAGE plpgsql
                    AS $$
                begin
                    IF NEW.unicef_id IS NULL THEN
                        NEW.unicef_id := format('INDC-%s', trim(replace(to_char(NEW.unicef_id_index,'0000,0000'),',','.')));
                    END IF;
                    return NEW;
                end
                $$;
                CREATE TRIGGER create_indc_unicef_id BEFORE INSERT ON household_individualcollection
                FOR EACH ROW EXECUTE PROCEDURE create_indc_unicef_id();
            """,
            reverse_sql="""
                  DROP TRIGGER IF EXISTS create_indc_unicef_id
                  ON household_individualcollection;
                """
        ),
        migrations.RunSQL(
            """
                UPDATE household_individualcollection 
                SET unicef_id = format('INDC-%s', trim(replace(to_char(unicef_id_index, '0000,0000'), ',', '.')))
                WHERE unicef_id IS NULL;
            """,
            reverse_sql=migrations.RunSQL.noop,
        ),
        migrations.RunSQL(
            """
                UPDATE household_householdcollection 
                SET unicef_id = format('HHC-%s', trim(replace(to_char(unicef_id_index, '0000,0000'), ',', '.')))
                WHERE unicef_id IS NULL;
            """,
            reverse_sql=migrations.RunSQL.noop,
        ),
    ]
