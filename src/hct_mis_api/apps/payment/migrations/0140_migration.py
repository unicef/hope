# Generated by Django 3.2.25 on 2024-07-17 13:59

import django.contrib.postgres.fields
from django.db import migrations, models
import django.db.models.deletion
import model_utils.fields
import uuid


def populate_delivery_mechanisms(apps, schema_editor):
    DeliveryMechanism = apps.get_model("payment", "DeliveryMechanism")

    data = [
        {
            "code": "cardless_cash_withdrawal",
            "name": "Cardless cash withdrawal",
            "requirements": {
                "required_fields": [],
                "optional_fields": [
                    "full_name",
                ],
                "unique_fields": [],
            },
            "transfer_type": "CASH",
        },
        {
            "code": "cash",
            "name": "Cash",
            "requirements": {
                "required_fields": [],
                "optional_fields": [
                    "full_name",
                ],
                "unique_fields": [],
            },
            "transfer_type": "CASH",
        },
        {
            "code": "cash_by_fsp",
            "name": "Cash by FSP",
            "requirements": {
                "required_fields": [],
                "optional_fields": [
                    "full_name",
                ],
                "unique_fields": [],
            },
            "transfer_type": "CASH",
        },
        {
            "code": "cheque",
            "name": "Cheque",
            "requirements": {
                "required_fields": [],
                "optional_fields": [
                    "full_name",
                ],
                "unique_fields": [],
            },
            "transfer_type": "CASH",
        },
        {
            "code": "deposit_to_card",
            "name": "Deposit to Card",
            "requirements": {
                "required_fields": [
                    "card_number__deposit_to_card",
                ],
                "optional_fields": [
                    "full_name",
                ],
                "unique_fields": [
                    "card_number__deposit_to_card",
                ],
            },
            "transfer_type": "CASH",
        },
        {
            "code": "mobile_money",
            "name": "Mobile Money",
            "requirements": {
                "required_fields": ["delivery_phone_number__mobile_money", "provider__mobile_money"],
                "optional_fields": [
                    "full_name",
                ],
                "unique_fields": ["delivery_phone_number__mobile_money", "provider__mobile_money"],
            },
            "transfer_type": "CASH",
        },
        {
            "code": "pre-paid_card",
            "name": "Pre-paid card",
            "requirements": {
                "required_fields": [],
                "optional_fields": [
                    "full_name",
                ],
                "unique_fields": [],
            },
            "transfer_type": "CASH",
        },
        {
            "code": "referral",
            "name": "Referral",
            "requirements": {
                "required_fields": [],
                "optional_fields": [
                    "full_name",
                ],
                "unique_fields": [],
            },
            "transfer_type": "CASH",
        },
        {
            "code": "transfer",
            "name": "Transfer",
            "requirements": {
                "required_fields": [],
                "optional_fields": [
                    "full_name",
                ],
                "unique_fields": [],
            },
            "transfer_type": "CASH",
        },
        {
            "code": "transfer_to_account",
            "name": "Transfer to Account",
            "requirements": {
                "required_fields": ["bank_name__transfer_to_account", "bank_account_number__transfer_to_account"],
                "optional_fields": [
                    "full_name",
                ],
                "unique_fields": [
                    "bank_account_number__transfer_to_account",
                ],
            },
            "transfer_type": "CASH",
        },
        {
            "code": "voucher",
            "name": "Voucher",
            "requirements": {
                "required_fields": [],
                "optional_fields": [
                    "full_name",
                ],
                "unique_fields": [],
            },
            "transfer_type": "VOUCHER",
        },
        {
            "code": "cash_over_the_counter",
            "name": "Cash over the counter",
            "requirements": {
                "required_fields": [
                    "mobile_phone_number__cash_over_the_counter",
                ],
                "optional_fields": [
                    "full_name",
                ],
                "unique_fields": [],
            },
            "transfer_type": "CASH",
        },
        {
            "code": "atm_card",
            "name": "ATM Card",
            "requirements": {
                "required_fields": [
                    "card_number__atm_card",
                    "card_expiry_date__atm_card",
                    "name_of_cardholder__atm_card",
                ],
                "optional_fields": [
                    "full_name",
                ],
                "unique_fields": [
                    "card_number__atm_card",
                    "card_expiry__date_atm_card",
                    "name_of_cardholder__atm_card",
                ],
            },
            "transfer_type": "CASH",
        },
        {
            "code": "transfer_to_digital_wallet",
            "name": "Transfer to Digital Wallet",
            "requirements": {
                "required_fields": [
                    "blockchain_name__transfer_to_digital_wallet",
                    "wallet_address__transfer_to_digital_wallet",
                ],
                "optional_fields": ["full_name", "wallet_name__transfer_to_digital_wallet"],
                "unique_fields": [
                    "blockchain_name__transfer_to_digital_wallet",
                    "wallet_address__transfer_to_digital_wallet",
                ],
            },
            "transfer_type": "DIGITAL",
        },
    ]
    for dm in data:
        DeliveryMechanism.objects.update_or_create(
            code=dm["code"],
            defaults={
                "name": dm["name"],
                "required_fields": dm["requirements"]["required_fields"],
                "optional_fields": dm["requirements"]["optional_fields"],
                "unique_fields": dm["requirements"]["unique_fields"],
                "transfer_type": dm["transfer_type"],
                "is_active": False,
            },
        )


class Migration(migrations.Migration):

    dependencies = [
        ("payment", "0139_migration"),
    ]

    operations = [
        migrations.CreateModel(
            name="DeliveryMechanism",
            fields=[
                (
                    "id",
                    model_utils.fields.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True, db_index=True)),
                ("updated_at", models.DateTimeField(auto_now=True, db_index=True)),
                ("payment_gateway_id", models.CharField(max_length=255, unique=True, null=True)),
                ("code", models.CharField(max_length=255, unique=True)),
                ("name", models.CharField(max_length=255, unique=True)),
                (
                    "optional_fields",
                    django.contrib.postgres.fields.ArrayField(
                        base_field=models.CharField(max_length=255), default=list, size=None
                    ),
                ),
                (
                    "required_fields",
                    django.contrib.postgres.fields.ArrayField(
                        base_field=models.CharField(max_length=255), default=list, size=None
                    ),
                ),
                (
                    "unique_fields",
                    django.contrib.postgres.fields.ArrayField(
                        base_field=models.CharField(max_length=255), default=list, size=None
                    ),
                ),
                ("is_active", models.BooleanField(default=True)),
                (
                    "transfer_type",
                    models.CharField(
                        choices=[("CASH", "Cash"), ("VOUCHER", "Voucher"), ("DIGITAL", "Digital")],
                        default="CASH",
                        max_length=255,
                    ),
                ),
            ],
            options={
                "verbose_name": "Delivery Mechanism",
                "verbose_name_plural": "Delivery Mechanisms",
                "ordering": ["code"],
            },
        ),
        migrations.RunPython(
            populate_delivery_mechanisms,
            migrations.RunPython.noop,
        ),
    ]
