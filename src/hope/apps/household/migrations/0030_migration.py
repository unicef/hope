# Generated by Django 5.2.8 on 2026-01-22 08:34

import django.core.validators
from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("core", "0016_migration"),
        ("geo", "0005_migration"),
        ("household", "0029_migration"),
        ("program", "0014_migration"),
        ("registration_data", "0010_migration"),
    ]

    operations = [
        migrations.AddField(
            model_name="household",
            name="originating_id",
            field=models.CharField(
                blank=True,
                help_text="A unified external reference with a fixed-length source prefix (XLS, KOB, or AUR)\n                     and a source-specific identifier separated by '#', e.g., 'KOB#321#123'.",
                max_length=150,
                null=True,
                validators=[
                    django.core.validators.RegexValidator(
                        message="originating_id must start with: KOB, AUR, XLS, API",
                        regex="^(KOB|AUR|XLS|API)#.+$",
                    )
                ],
            ),
        ),
        migrations.AddField(
            model_name="individual",
            name="originating_id",
            field=models.CharField(
                blank=True,
                help_text="A unified external reference with a fixed-length source prefix (XLS, KOB, or AUR)\n                     and a source-specific identifier separated by '#', e.g., 'KOB#321#123'.",
                max_length=150,
                null=True,
                validators=[
                    django.core.validators.RegexValidator(
                        message="originating_id must start with: KOB, AUR, XLS, API",
                        regex="^(KOB|AUR|XLS|API)#.+$",
                    )
                ],
            ),
        ),
        migrations.AddConstraint(
            model_name="household",
            constraint=models.UniqueConstraint(
                condition=models.Q(("is_removed", False), ("originating_id__isnull", False)),
                fields=("originating_id",),
                name="originating_id_hh_unique_constraint",
            ),
        ),
        migrations.AddConstraint(
            model_name="individual",
            constraint=models.UniqueConstraint(
                condition=models.Q(("is_removed", False), ("originating_id__isnull", False)),
                fields=("originating_id",),
                name="originating_id_ind_unique_constraint",
            ),
        ),
    ]
