# Generated by Django 3.2.25 on 2025-09-18 09:40

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("program", "0008_migration"),
    ]

    operations = [
        migrations.RunSQL(
            """
            ALTER TABLE program_program
            ADD COLUMN status_rank smallint GENERATED ALWAYS AS (
              CASE status
                WHEN 'DRAFT' THEN 1
                WHEN 'ACTIVE' THEN 2
                WHEN 'FINISHED' THEN 3
                ELSE 99
              END
            ) STORED;
            CREATE INDEX prog_status_rank_id_idx ON program_program (status_rank, id);
            """,
            """
            DROP INDEX IF EXISTS prog_status_rank_id_idx;
            ALTER TABLE program_program DROP COLUMN IF EXISTS status_rank;
            """,
            state_operations=[
                migrations.AddField(
                    "program",
                    "status_rank",
                    models.PositiveSmallIntegerField(help_text="Auto-generated field for faster sorting"),
                ),
            ],
        )
    ]
